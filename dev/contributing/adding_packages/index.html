<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Adding a new package to the common interface · DiffEq Developer Documentation</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../../index.html"><img class="logo" src="../../assets/logo.png" alt="DiffEq Developer Documentation logo"/></a><h1>DiffEq Developer Documentation</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Contributor Guide</span><ul><li><a class="toctext" href="../ecosystem_overview/">Ecosystem Overview</a></li><li class="current"><a class="toctext" href>Adding a new package to the common interface</a><ul class="internal"><li><a class="toctext" href="#Defining-the-types-1">Defining the types</a></li><li><a class="toctext" href="#Defining-the-overloads-1">Defining the overloads</a></li><li><a class="toctext" href="#Defining-the-solution-1">Defining the solution</a></li></ul></li><li><a class="toctext" href="../adding_algorithms/">Adding Algorithms</a></li><li><a class="toctext" href="../defining_problems/">Developing A New Problem</a></li><li><a class="toctext" href="../diffeq_internals/">The DiffEq Internals</a></li><li><a class="toctext" href="../type_traits/">Type Traits</a></li></ul></li><li><span class="toctext">Algorithm Development Tools</span><ul><li><a class="toctext" href="../../alg_dev/test_problems/">Test Problems</a></li><li><a class="toctext" href="../../alg_dev/convergence/">Convergence Simulations</a></li><li><a class="toctext" href="../../alg_dev/benchmarks/">Benchmark Suite</a></li></ul></li><li><span class="toctext">Internal Documentation</span><ul><li><a class="toctext" href="../../internals/notes_on_algorithms/">Notes on Algorithms</a></li><li><a class="toctext" href="../../internals/tableaus/">ODE Tableaus</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Contributor Guide</li><li><a href>Adding a new package to the common interface</a></li></ul><a class="edit-page" href="https://github.com/JuliaDiffEq/DiffEqDevDocs.jl/blob/master/docs/src/contributing/adding_packages.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Adding a new package to the common interface</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Adding-a-new-package-to-the-common-interface-1" href="#Adding-a-new-package-to-the-common-interface-1">Adding a new package to the common interface</a></h1><p>DiffEq&#39;s distributed infrastructure allows anyone to add new packages to the common interface. This set of the documentation explains how this is done. An example package is <a href="https://github.com/JuliaDiffEq/DASKR.jl/blob/master/src/common.jl">DASRK.jl</a> whose full common interface bindings are contained in <code>common.jl</code>.</p><h2><a class="nav-anchor" id="Defining-the-types-1" href="#Defining-the-types-1">Defining the types</a></h2><p>You should start by defining a common supertype for all your algorithm types. DASKR has DAE algorithms, so it defines</p><pre><code class="language-julia">abstract type DASKRDAEAlgorithm{LinearSolver} &lt;: DiffEqBase.AbstractDAEAlgorithm end</code></pre><p>that its algorithms are all <code>AbstractDAEAlgorithm</code>s and gives them a possible type parameter as well. Then the concrete algorithms are specified. Special options (i.e. non-common interface options) for the algorithm go in this type. Here there is a choice for a linear solver internally, so we allow the user to set this:</p><pre><code class="language-julia">struct daskr{LinearSolver} &lt;: DASKRDAEAlgorithm{LinearSolver} end
daskr(;linear_solver=:Dense) = daskr{linear_solver}()</code></pre><p>In many (most?) cases, no extra constructor is needed since there are no extra options.</p><h2><a class="nav-anchor" id="Defining-the-overloads-1" href="#Defining-the-overloads-1">Defining the overloads</a></h2><p>Now you need to add DiffEqBase. The package should reexport <code>DiffEqBase.jl</code> to make using it alone act naturally, and this is done by:</p><pre><code class="language-julia">using Reexport
@reexport using DiffEqBase</code></pre><p>now we overload <code>__solve</code> from <code>DiffEqBase.jl</code> to act on our algorithm. Here&#39;s a possible signature:</p><pre><code class="language-julia">function DiffEqBase.__solve{uType,duType,tType,isinplace,LinearSolver}(
    prob::AbstractDAEProblem{uType,duType,tType,isinplace},
    alg::DASKRDAEAlgorithm{LinearSolver},
    timeseries = [], ts = [], ks = [];

    verbose=true,
    callback = nothing, abstol = 1/10^6, reltol = 1/10^3,
    saveat = Float64[], adaptive = true, maxiters = Int(1e5),
    timeseries_errors = true, save_everystep = isempty(saveat), dense = save_everystep,
    save_start = true, save_timeseries = nothing,
    userdata = nothing,
    kwargs...)</code></pre><p>Basically you just dispatch on your algorithm supertype (and refine the <code>Problem</code> choice as well so it errors on the wrong problem types), then list the common interface options. <code>timeseries = [], ts = [], ks = [];</code> are for pre-allocation of arrays, and this may change in the near future but you can use this to pre-allocate the <code>t</code>, <code>u</code>, and <code>k</code> arrays (<code>k</code> being internal steps if saved).</p><h2><a class="nav-anchor" id="Defining-the-solution-1" href="#Defining-the-solution-1">Defining the solution</a></h2><p>In <code>solve</code> you do option handling and call your solver. At the end, you return the solution via:</p><pre><code class="language-julia">build_solution(prob,alg,ts,timeseries,
               du = dures,
               dense = dense,
               timeseries_errors = timeseries_errors,
               retcode = :Success)</code></pre><p>Giving <code>du</code> is only currently allowed for DAEs and is optional. The errors flags (<code>timeseries_errors</code> and <code>dense_errors</code>) are flags for allowing the solution to calculate errors which should be passed through the <code>solve</code> function if applicable. A proper <code>retcode</code> should be placed or it will default to <code>:Default</code>.</p><footer><hr/><a class="previous" href="../ecosystem_overview/"><span class="direction">Previous</span><span class="title">Ecosystem Overview</span></a><a class="next" href="../adding_algorithms/"><span class="direction">Next</span><span class="title">Adding Algorithms</span></a></footer></article></body></html>
